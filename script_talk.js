/** =========================================
 *  [A] ì „ì—­ ì„¤ì •
 * ========================================= */
// ì¹´ì¹´ì˜¤ ì•Œë¦¬ê³  API ê´€ë ¨ ì„¤ì •
const ALIMTALK_API_URL = 'https://kakaoapi.aligo.in/akv10/alimtalk/send/';
const ALIMTALK_API_KEY = 's2qfjf9gxkhzv0ms04bt54f3w8w6b9jd';  // ì˜ˆì‹œ
const ALIMTALK_USER_ID = 'yangjujamjam';                    // ì˜ˆì‹œ
const ALIMTALK_SENDERKEY = 'fc0570b6c7f7785506ea85b62838fd6fb37a3bcc'; // ì˜ˆì‹œ
const ALIMTALK_SENDER = '01059055559'; // ë°œì‹ ë²ˆí˜¸

// í…œí”Œë¦¿ ì½”ë“œ
// - ë¬´í†µì¥(ë¬´í†µì¥/ìˆ˜ê¸°ì‘ì„±)
const TPLCODE_DEPOSIT = 'TY_7495';
// - ìˆ™ë°•
const TPLCODE_STAY = 'TY_8947';
// - ë‹¹ì¼(ëŒ€ì‹¤)
const TPLCODE_DAYUSE = 'TY_8948';

// í…œí”Œë¦¿ ë¬¸ìì—´
const TEMPLATE_DEPOSIT = 
`ê³ ê°ë‹˜ ì˜ˆì•½ ì‹ ì²­í•´ ì£¼ì…”ì„œ 
ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

#{íŒŒì‹±ë‚´ìš©}

*ì¶”ê°€ ì˜µì…˜ì€ ì²´í¬ì¸ ì‹œ í˜„ì¥ ê²°ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
(ì¸ì›ì¶”ê°€, ì–¼ë¦¬ì²´í¬ì¸, ë ˆì´íŠ¸ì²´í¬ì•„ì›ƒ, ë°”ë² í, ë¶ˆë©, ì˜¨ìˆ˜í’€, ê³ ê¸°ì„¸íŠ¸ ë“±)

*ìˆ™ë°•ì€ â€œ15ì‹œâ€ë¶€í„° ì…ì‹¤ ê°€ëŠ¥í•˜ë©° ìˆ˜ì˜ì€ 13ì‹œë¶€í„° ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì–¼ë¦¬ì²´í¬ì¸ì„ ì›í•˜ì‹¤ ê²½ìš° ì¹´í†¡ìœ¼ë¡œ ë³„ë„ ë¬¸ì˜ì£¼ì„¸ìš”.

â–¶ê³„ì¢Œë²ˆí˜¸  ìš°ë¦¬ 1005 504 540028 (ì£¼) ìœ ì—°ìŒ

â€»ì…ê¸ˆ ì‹œ ì…ê¸ˆì, ì˜ˆì•½ìëª…ì´ ë™ì¼í•´ì•¼ í•˜ë©°, ì˜ˆì•½ ì•ˆë‚´ ìˆ˜ì‹  í›„ "2ì‹œê°„ ì´ë‚´" ì…ê¸ˆ í™•ì¸ì´ ì•ˆ ë  ì‹œ ìë™ ì·¨ì†Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`;

const TEMPLATE_STAY = 
`[ì–‘ì£¼ì¼ì¼]
ì˜ˆì•½í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤â™¬

#{íŒŒì‹±ë‚´ìš©}

â–  2ì¸ ì´ˆê³¼ ì‹œ, ì¸ì›ì¶”ê°€ë¥¼ ë¯¸ì„ íƒí•˜ì…¨ë‹¤ë©´ í˜„ì¥ì—ì„œ ì¶”ê°€ê²°ì œê°€ í•„ìš”í•©ë‹ˆë‹¤.
â–  ì˜µì…˜(ì¸ì›ì¶”ê°€, ë°”ë² í, ë¶ˆë©, ì˜¨ìˆ˜í’€)ì€ ë³„ë„ì´ë©° í˜„ì¥ ê²°ì œê°€ëŠ¥í•©ë‹ˆë‹¤.
â€»ê³ ê¸° ë° ì±„ì†Œê°€ ìˆëŠ” ì˜µì…¥ì€ ë‹¹ì¼ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
(ëŒ€í˜•í’€ ë¬´ë£Œ ì´ìš© / ì˜¨ìˆ˜í’€ ìœ ë£Œ ì´ìš©)

â–  ì„ íƒí•˜ì‹  ì…ì‹¤ì‹œê°„ì„ ì¤€ìˆ˜í•´ì£¼ì„¸ìš”.
â–  ì–¼ë¦¬ì²´í¬ì¸/ë ˆì´íŠ¸ì²´í¬ì•„ì›ƒì€ 1ì‹œê°„ë‹¹ 1ì¸ 5,000ì›ì˜ ì¶”ê°€ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.
ì´ìš©ì„ ì›í•˜ì‹¤ ê²½ìš° ë°˜ë“œì‹œ ì‚¬ì „ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.
â–  ìˆ˜ì˜ì¥ì€ ì²´í¬ì¸ ì‹œê°„ 2ì‹œê°„ ì „ë¶€í„° ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì˜ˆì•½ ë‚´ìš©ì„ í™•ì¸í•˜ì‹  í›„, ìˆ˜ì • ë˜ëŠ” ë³€ê²½ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

â–  í™˜ë¶ˆê·œì •
â–¶ ì·¨ì†Œìˆ˜ìˆ˜ë£Œ

ì…ì‹¤ 10ì¼ì „ - ì—†ìŒ
ì…ì‹¤ 9ì¼ì „ - 10%
ì…ì‹¤ 8ì¼ì „ - 20%
ì…ì‹¤ 7ì¼ì „ - 30%
ì…ì‹¤ 6ì¼ì „ - 40%
ì…ì‹¤ 5ì¼ì „ - 50%
ì…ì‹¤ 4ì¼ì „ - 60%
ì…ì‹¤ 3ì¼ì „ - 70%
ì…ì‹¤ 2ì¼ì „ ~ ë‹¹ì¼ -  100%

- ê¸°ìƒì•…í™” & ì²œì¬ì§€ë³€ìœ¼ë¡œ ì¸í•œ ì·¨ì†Œ ë° í™˜ë¶ˆì€ ì–´ë µìŠµë‹ˆë‹¤`;

const TEMPLATE_DAYUSE =
`[ì–‘ì£¼ì¼ì¼] ì˜ˆì•½í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤â™¬
â–  ê¸°ë³¸ ì´ìš©ì‹œê°„ì€ 6ì‹œê°„ì´ë©° ì˜ˆì•½í•´ì£¼ì‹  ë°©ë¬¸ì‹œê°„ì„ ì—„ìˆ˜í•´ ì£¼ì„¸ìš”.

#{íŒŒì‹±ë‚´ìš©}

â–  2ì¸ ì´ˆê³¼ ì‹œ, ì¸ì›ì¶”ê°€ë¥¼ ë¯¸ì„ íƒí•˜ì…¨ë‹¤ë©´ í˜„ì¥ì—ì„œ ì¶”ê°€ê²°ì œê°€ í•„ìš”í•©ë‹ˆë‹¤.
â–  ì˜µì…˜(ì¸ì›ì¶”ê°€, ë°”ë² í, ë¶ˆë©, ì˜¨ìˆ˜í’€)ì€ ë³„ë„ì´ë©° í˜„ì¥ ê²°ì œê°€ëŠ¥í•©ë‹ˆë‹¤.
â€»ê³ ê¸° ë° ì±„ì†Œê°€ ìˆëŠ” ì˜µì…˜ì€ ë‹¹ì¼ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
(ëŒ€í˜•í’€ ë¬´ë£Œ ì´ìš© / ì˜¨ìˆ˜í’€ ìœ ë£Œ ì´ìš©)

â–  ì„ íƒí•˜ì‹  ì…ì‹¤ì‹œê°„ì„ ì¤€ìˆ˜í•´ì£¼ì„¸ìš”.
â–  ì–¼ë¦¬ì²´í¬ì¸/ë ˆì´íŠ¸ì²´í¬ì•„ì›ƒì€ 1ì‹œê°„ë‹¹ 1ì¸ 5,000ì›ì˜ ì¶”ê°€ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.
ì´ìš©ì„ ì›í•˜ì‹¤ ê²½ìš° ë°˜ë“œì‹œ ì‚¬ì „ ë¬¸ì˜ ë°”ëë‹ˆë‹¤.
â–  ìˆ˜ì˜ì¥ì€ ì²´í¬ì¸ ì‹œê°„ 2ì‹œê°„ ì „ë¶€í„° ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì˜ˆì•½ ë‚´ìš©ì„ í™•ì¸í•˜ì‹  í›„, ìˆ˜ì • ë˜ëŠ” ë³€ê²½ ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

â–  í™˜ë¶ˆê·œì •
â–¶ ì·¨ì†Œìˆ˜ìˆ˜ë£Œ

ì…ì‹¤ 10ì¼ì „ - ì—†ìŒ
ì…ì‹¤ 9ì¼ì „ - 10%
ì…ì‹¤ 8ì¼ì „ - 20%
ì…ì‹¤ 7ì¼ì „ - 30%
ì…ì‹¤ 6ì¼ì „ - 40%
ì…ì‹¤ 5ì¼ì „ - 50%
ì…ì‹¤ 4ì¼ì „ - 60%
ì…ì‹¤ 3ì¼ì „ - 70%
ì…ì‹¤ 2ì¼ì „ ~ ë‹¹ì¼ -  100%

- ê¸°ìƒì•…í™” & ì²œì¬ì§€ë³€ìœ¼ë¡œ ì¸í•œ ì·¨ì†Œ ë° í™˜ë¶ˆì€ ì–´ë µìŠµë‹ˆë‹¤`;

// ì „ì—­ ë³€ìˆ˜: "ì•ˆë‚´ë¬¸ì ì–‘ì‹ì ìš©" ì‹œ ì—¬ê¸° ì €ì¥ â†’ "ì•Œë¦¼í†¡ ë°œì†¡"ì—ì„œ ì‚¬ìš©
window.lastReservationData = null;  


/** =========================================
 *  [B] "ì•ˆë‚´ë¬¸ì ì–‘ì‹ì ìš©" ë²„íŠ¼ â†’ ë©”ì‹œì§€ ìƒì„±
 * =========================================
 * - ìˆ˜ê¸°ì‘ì„± íƒ­ì´ë©´: getManualReservationDataSingle()
 * - ë¶™ì—¬ë„£ê¸° íƒ­ì´ë©´: parseReservation(text)
 * - ê·¸ ê²°ê³¼ë¥¼ window.lastReservationData ì— ì €ì¥
 * - ì•ˆë‚´ë¬¸ì í¬ë§·íŒ…ëœ ë‚´ìš©(#outputData)ì— ì¶œë ¥ & í´ë¦½ë³´ë“œ ë³µì‚¬
 */
function generateReservationMessage() {
  let data;
  let rawText = '';

  // 1) íƒ­ êµ¬ë¶„
  if (isManualTabActive()) {
    data = getManualReservationDataSingle();
  } else {
    rawText = document.getElementById('inputData').value.trim();
    data = parseReservation(rawText);
  }

  // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ì•Œë¦¼í†¡ ë²„íŠ¼ì—ì„œ ì¬ì‚¬ìš©)
  window.lastReservationData = data;

  // 2) ì•ˆë‚´ë¬¸ììš© ë©”ì‹œì§€ ìƒì„±
  const formattedParsedData = `
- ì˜ˆì•½ë²ˆí˜¸: ${data.ì˜ˆì•½ë²ˆí˜¸ || ''}
- ì˜ˆì•½ì: ${data.ì˜ˆì•½ì || ''}
- ì „í™”ë²ˆí˜¸: ${data.ì „í™”ë²ˆí˜¸ || ''}
- ì´ìš©ê°ì‹¤: ${data.ì´ìš©ê°ì‹¤ || ''}
- ì´ìš©ê¸°ê°„: ${data.ì´ìš©ê¸°ê°„ || ''}
- ìˆ˜ëŸ‰: ${data.ìˆ˜ëŸ‰ || '(ë³µìˆ˜ê°ì‹¤)'}
- ì˜µì…˜: ${data.ì˜µì…˜ || 'ì—†ìŒ'}
- ì´ ì´ìš© ì¸ì›: ${data.ì´ì´ìš©ì¸ì› || ''}
- ì…ì‹¤ì‹œê°„: ${data.ì…ì‹¤ì‹œê°„ || ''}
- ê²°ì œê¸ˆì•¡: ${data.ê²°ì œê¸ˆì•¡ || ''}
- ì˜ˆì•½í”Œë«í¼: ${data.ì˜ˆì•½í”Œë«í¼ || ''}`.trim();

  // (ê¸°ì¡´ ì˜ˆì‹œ) ë¬´í†µì¥/ìˆ˜ê¸°ë¼ë©´ íŠ¹ì • ì•ˆë‚´ë¬¸êµ¬, ë„¤ì´ë²„ë©´ ë‹¤ë¥¸ ë¬¸êµ¬, ...
  // --- ì›í•˜ëŠ” ëŒ€ë¡œ ë¶„ê¸°í•´ì„œ message ì™„ì„± ---
  let message = '';

  if ((data.ì˜ˆì•½í”Œë«í¼ || '').includes('ë¬´í†µì¥') || (data.ì˜ˆì•½í”Œë«í¼ || '').includes('ìˆ˜ê¸°ì…ë ¥')) {
    // ë¬´í†µì¥/ìˆ˜ê¸°ì‘ì„±
    message = `ê³ ê°ë‹˜ ì˜ˆì•½ ì‹ ì²­í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

${formattedParsedData}

*ì¶”ê°€ ì˜µì…˜ì€ ì²´í¬ì¸ ì‹œ í˜„ì¥ ê²°ì œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
(ì¸ì›ì¶”ê°€, ì–¼ë¦¬ì²´í¬ì¸, ë ˆì´íŠ¸ì²´í¬ì•„ì›ƒ, ë°”ë² í, ë¶ˆë©, ì˜¨ìˆ˜í’€, ê³ ê¸°ì„¸íŠ¸ ë“±)

*ìˆ™ë°•ì€ â€œ15ì‹œâ€ë¶€í„° ì…ì‹¤ ê°€ëŠ¥í•˜ë©° ìˆ˜ì˜ì€ 13ì‹œë¶€í„° ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì–¼ë¦¬ì²´í¬ì¸ì„ ì›í•˜ì‹¤ ê²½ìš° ì¹´í†¡ìœ¼ë¡œ ë³„ë„ ë¬¸ì˜ì£¼ì„¸ìš”.

â–¶ê³„ì¢Œë²ˆí˜¸  ìš°ë¦¬ 1005 504 540028 (ì£¼) ìœ ì—°ìŒ

â€»ì…ê¸ˆ ì‹œ ì…ê¸ˆì, ì˜ˆì•½ìëª…ì´ ë™ì¼í•´ì•¼ í•˜ë©°, ì˜ˆì•½ ì•ˆë‚´ ìˆ˜ì‹  í›„ "2ì‹œê°„ ì´ë‚´" ì…ê¸ˆ í™•ì¸ì´ ì•ˆ ë  ì‹œ ìë™ ì·¨ì†Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`;
  }
  else if ((data.ì˜ˆì•½í”Œë«í¼ || '') === 'ë„¤ì´ë²„' && data.ì´ìš©ê¸°ê°„ && !data.ì´ìš©ê¸°ê°„.includes('~')) {
    // ë„¤ì´ë²„ ë‹¹ì¼ (ëŒ€ì‹¤)
    message = `[ì–‘ì£¼ì¼ì¼] ì˜ˆì•½í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤â™¬

*ê¸°ë³¸ ì´ìš©ì‹œê°„ì€ 6ì‹œê°„ì´ë©° ì˜ˆì•½í•´ì£¼ì‹  ë°©ë¬¸ì‹œê°„ì„ ì—„ìˆ˜í•´ ì£¼ì„¸ìš”.

${formattedParsedData}

*2ì¸ ê¸°ì¤€ ìš”ê¸ˆì´ë©° ì¸ì›ì¶”ê°€ ë¯¸ì„ íƒ ì‹œ í˜„ì¥ì—ì„œ ì¶”ê°€ê²°ì œí•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.
*ì˜µì…˜(ë°”ë² í, ë¶ˆë©, ê³ ê¸°ì„¸íŠ¸)ì€ ë³„ë„ì´ë©° ì²´í¬ì¸ ì‹œ í˜„ì¥ ê²°ì œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
*ëŒ€í˜•í’€ ë¬´ë£Œ ì´ìš© / ì˜¨ìˆ˜í’€ ìœ ë£Œ ì´ìš©

ì˜ˆì•½ ë‚´ìš© í™•ì¸í•´ë³´ì‹œê³  ìˆ˜ì • ë˜ëŠ” ë³€ê²½í•´ì•¼í•  ë‚´ìš©ì´ ìˆë‹¤ë©´ ë§ì”€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.`;
  }
  else if ((data.ì˜ˆì•½í”Œë«í¼ || '').includes('ë„¤ì´ë²„')) {
    // ë„¤ì´ë²„ ìˆ™ë°•
    message = `[ì–‘ì£¼ì¼ì¼] ì˜ˆì•½í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤â™¬

${formattedParsedData}

*ê¸°ì¤€ì¸ì› 2ì¸ ê¸°ì¤€ ìš”ê¸ˆì´ë©° ì¸ì›ì¶”ê°€ ë¯¸ì„ íƒ ì‹œ í˜„ì¥ì—ì„œ ì¶”ê°€ê²°ì œí•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.
*ì˜µì…˜(ë°”ë² í, ë¶ˆë©, ê³ ê¸°ì„¸íŠ¸)ì€ ë³„ë„ì´ë©° ì²´í¬ì¸ ì‹œ í˜„ì¥ ê²°ì œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
*ëŒ€í˜•í’€ ë¬´ë£Œ ì´ìš© / ì˜¨ìˆ˜í’€ ìœ ë£Œ ì´ìš©

*ìˆ™ë°•ì€ â€œ15ì‹œâ€ë¶€í„° ì…ì‹¤ ê°€ëŠ¥í•˜ë©° ìˆ˜ì˜ì¥ ì´ìš©ì€ 13ì‹œë¶€í„° ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì–¼ë¦¬ì²´í¬ì¸/ë ˆì´íŠ¸ì²´í¬ì•„ì›ƒì„ ì›í•˜ì‹¤ ê²½ìš° ì¹´í†¡ ë˜ëŠ” ë¬¸ìë¡œ ë³„ë„ ë¬¸ì˜ì£¼ì„¸ìš”.

(ê´‘ê³ )
ì–‘ì† ê°€ë³ê²Œ, ì¼ì¼ ë°”ë² í í‚¤íŠ¸ ì¶œì‹œğŸ–
https://litt.ly/jamjam_bbq`;
  }
  else if ((data.ì˜ˆì•½í”Œë«í¼ || '').includes('ì•¼ë†€ì')) {
    // ì•¼ë†€ì
    message = `[ì–‘ì£¼ì¼ì¼] ì˜ˆì•½í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤â™¬

ì•¼ë†€ìë¡œ ì˜ˆì•½í•˜ì…¨ë‹¤ë©´
ì—¬ê¸°ë¡œ ì„±í•¨ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ê¼­ ë‚¨ê²¨ì£¼ì„¸ìš”!

${formattedParsedData}

*ê¸°ì¤€ì¸ì› 2ì¸ ê¸°ì¤€ ìš”ê¸ˆì´ë©° ì¸ì›ì¶”ê°€ ë¯¸ì„ íƒ ì‹œ í˜„ì¥ì—ì„œ ì¶”ê°€ê²°ì œí•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.
*ì˜µì…˜(ë°”ë² í, ë¶ˆë©, ê³ ê¸°ì„¸íŠ¸)ì€ ë³„ë„ì´ë©° ì²´í¬ì¸ ì‹œ í˜„ì¥ ê²°ì œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
*ëŒ€í˜•í’€ ë¬´ë£Œ ì´ìš© / ì˜¨ìˆ˜í’€ ìœ ë£Œ ì´ìš©

ì²´í¬ì¸ ë˜ëŠ” ì²´í¬ì•„ì›ƒ í•˜ì‹¤ ë•Œ ê´€ë¦¬ë™ì— ë§ì”€í•´ ì£¼ì‹œë©´ í™˜ë¶ˆì²˜ë¦¬ ë„ì™€ë“œë¦½ë‹ˆë‹¤.^^
ì˜ˆì•½ ë‚´ìš© í™•ì¸í•´ë³´ì‹œê³  ìˆ˜ì • ë˜ëŠ” ë³€ê²½í•´ì•¼í•  ë‚´ìš©ì´ ìˆë‹¤ë©´ ë§ì”€ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

(ê´‘ê³ )
ì–‘ì† ê°€ë³ê²Œ, ì¼ì¼ ë°”ë² í í‚¤íŠ¸ ì¶œì‹œğŸ–
https://litt.ly/jamjam_bbq`;
  }
  else if ((data.ì˜ˆì•½í”Œë«í¼ || '').includes('ì—¬ê¸°ì–´ë•Œ')) {
    // ì—¬ê¸°ì–´ë•Œ
    message = `[ì–‘ì£¼ì¼ì¼] ì˜ˆì•½í•´ ì£¼ì…”ì„œ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬í•©ë‹ˆë‹¤â™¬

ì—¬ê¸°ì–´ë•Œë¡œ ì˜ˆì•½í•˜ì…¨ë‹¤ë©´
ì—¬ê¸°ë¡œ ì„±í•¨ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ê¼­ ë‚¨ê²¨ì£¼ì„¸ìš”!

${formattedParsedData}

*ê¸°ì¤€ì¸ì› 2ì¸ ê¸°ì¤€ ìš”ê¸ˆì´ë©° ì¸ì›ì¶”ê°€ ë¯¸ì„ íƒ ì‹œ í˜„ì¥ì—ì„œ ì¶”ê°€ê²°ì œí•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.
*ì˜µì…˜(ë°”ë² í, ë¶ˆë©, ê³ ê¸°ì„¸íŠ¸)ì€ ë³„ë„ì´ë©° ì²´í¬ì¸ ì‹œ í˜„ì¥ ê²°ì œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
*ëŒ€í˜•í’€ ë¬´ë£Œ ì´ìš© / ì˜¨ìˆ˜í’€ ìœ ë£Œ ì´ìš©

(ê´‘ê³ )
ì–‘ì† ê°€ë³ê²Œ, ì¼ì¼ ë°”ë² í í‚¤íŠ¸ ì¶œì‹œğŸ–
https://litt.ly/jamjam_bbq`;
  }
  else {
    // ê·¸ ì™¸ í”Œë«í¼(ìˆ˜ê¸°ì…ë ¥ ì´ì™¸ ë“±)
    message = `ê³ ê°ë‹˜ ì˜ˆì•½í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

${formattedParsedData}

(ê¸°íƒ€ ì•ˆë‚´ë¬¸êµ¬)`;
  }

  // 3) #outputDataì— í‘œì‹œ + í´ë¦½ë³´ë“œ ë³µì‚¬
  document.getElementById('outputData').textContent = message;
  navigator.clipboard.writeText(message)
    .then(() => alert('ì•ˆë‚´ë¬¸ìê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'))
    .catch(() => alert('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨'));
}


/** =========================================
 *  [C] "ì•Œë¦¼í†¡ ë°œì†¡" ë²„íŠ¼ â†’ í™•ì¸ í›„ send
 * ========================================= */
function confirmAlimtalk() {
  const ok = confirm("ì•Œë¦¼í†¡ì„ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?");
  if(!ok) return;

  if (!window.lastReservationData) {
    alert("ë¨¼ì € [ì•ˆë‚´ë¬¸ì ì–‘ì‹ì ìš©] ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜ˆì•½ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
    return;
  }
  sendAlimtalk(window.lastReservationData);
}


/** =========================================
 *  (D) ì•Œë¦¼í†¡ ë°œì†¡ í•¨ìˆ˜
 * =========================================
 * ì‹¤ì œ ì•Œë¦¬ê³  ì„œë²„ë¡œ POST ìš”ì²­
 */
async function sendAlimtalk(data) {
  // 1) í…œí”Œë¦¿ì½”ë“œ ê²°ì •
  const tplCode = decideTemplateCode(data);

  // 2) #{íŒŒì‹±ë‚´ìš©} ìƒì„±
  const parsingText = buildParsingContent(data);

  // 3) ìµœì¢… ë©”ì‹œì§€ ìƒì„±
  const finalMessage = buildTemplateMessage(tplCode, parsingText);

  // 4) ì•Œë¦¬ê³  API ì „ì†¡ íŒŒë¼ë¯¸í„°
  const params = new URLSearchParams();
  params.append('apikey',    ALIMTALK_API_KEY);
  params.append('userid',    ALIMTALK_USER_ID);
  params.append('senderkey', ALIMTALK_SENDERKEY);
  params.append('tpl_code',  tplCode);
  params.append('sender',    ALIMTALK_SENDER);

  // ìˆ˜ì‹ ì
  const phoneOnly = (data.ì „í™”ë²ˆí˜¸ || '').replace(/[^0-9]/g, '');
  params.append('receiver_1', phoneOnly || '01000000000');
  params.append('recvname_1', data.ì˜ˆì•½ì || 'ê³ ê°ë‹˜');

  // ì œëª©, ë©”ì‹œì§€
  params.append('subject_1', '[ì–‘ì£¼ì¼ì¼] ì˜ˆì•½ì•ˆë‚´');
  params.append('message_1', finalMessage);

  // ëŒ€ì²´ë°œì†¡ ì„¤ì •
  params.append('failover', 'N');

  // 5) fetch POST
  try {
    const res = await fetch(ALIMTALK_API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      },
      body: params.toString()
    });
    const result = await res.json();
    console.log('ì•Œë¦¼í†¡ ë°œì†¡ ê²°ê³¼:', result);

    if (result.code === 0) {
      alert("ì•Œë¦¼í†¡ ë°œì†¡ ì„±ê³µ: " + result.message);
    } else {
      alert("ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨: " + result.message);
    }
  } catch (err) {
    console.error('ì•Œë¦¼í†¡ ë°œì†¡ ì˜¤ë¥˜:', err);
    alert("ì•Œë¦¼í†¡ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
}


/** =========================================
 *  (E) í…œí”Œë¦¿ ì½”ë“œ ë° ë©”ì‹œì§€ ê²°ì • ë¡œì§
 * ========================================= */

/** (1) í…œí”Œë¦¿ ì½”ë“œ ê²°ì • */
function decideTemplateCode(data) {
  const platform = (data.ì˜ˆì•½í”Œë«í¼ || '').toLowerCase();
  const period   = (data.ì´ìš©ê¸°ê°„   || '');
  const checkin  = (data.ì…ì‹¤ì‹œê°„   || '').toLowerCase();

  // ë¬´í†µì¥ or ìˆ˜ê¸°ì…ë ¥
  if (platform.includes('ë¬´í†µì¥') || platform.includes('ìˆ˜ê¸°ì…ë ¥')) {
    return TPLCODE_DEPOSIT; // TY_7495
  }

  // ì•¼ë†€ì
  if (platform.includes('ì•¼ë†€ì')) {
    // ëŒ€ì‹¤ì´ë©´ ë‹¹ì¼, ìˆ™ë°•ì´ë©´ ìˆ™ë°•
    if (checkin.includes('[ìˆ™ë°•]')) return TPLCODE_STAY;
    else                            return TPLCODE_DAYUSE;
  }

  // ë„¤ì´ë²„ (ë¬´í†µì¥ ì•„ë‹Œ ì¼ë°˜ ë„¤ì´ë²„)
  if (platform.includes('ë„¤ì´ë²„')) {
    // ê¸°ê°„ì— '~' ìˆìœ¼ë©´ ìˆ™ë°•, ì—†ìœ¼ë©´ ë‹¹ì¼
    return period.includes('~') ? TPLCODE_STAY : TPLCODE_DAYUSE;
  }

  // ì—¬ê¸°ì–´ë•Œ â†’ ê¸°ë³¸ ìˆ™ë°•
  if (platform.includes('ì—¬ê¸°ì–´ë•Œ')) {
    return TPLCODE_STAY;
  }

  // ê·¸ ì™¸ë„ ê¸°ë³¸ ìˆ™ë°•
  return TPLCODE_STAY;
}

/** (2) "#{íŒŒì‹±ë‚´ìš©}" ë§Œë“¤ê¸° */
function buildParsingContent(data) {
  return `
- ì˜ˆì•½ë²ˆí˜¸: ${data.ì˜ˆì•½ë²ˆí˜¸ || ''}
- ì˜ˆì•½ì: ${data.ì˜ˆì•½ì || ''}
- ì „í™”ë²ˆí˜¸: ${data.ì „í™”ë²ˆí˜¸ || ''}
- ì´ìš©ê°ì‹¤: ${data.ì´ìš©ê°ì‹¤ || ''}
- ì´ìš©ê¸°ê°„: ${data.ì´ìš©ê¸°ê°„ || ''}
- ìˆ˜ëŸ‰: ${data.ìˆ˜ëŸ‰ || '(ë³µìˆ˜ê°ì‹¤)'}
- ì˜µì…˜: ${data.ì˜µì…˜ || 'ì—†ìŒ'}
- ì´ ì´ìš© ì¸ì›: ${data.ì´ì´ìš©ì¸ì› || 'ëŒ€ì¸2'}
- ì…ì‹¤ì‹œê°„: ${data.ì…ì‹¤ì‹œê°„ || ''}
- ê²°ì œê¸ˆì•¡: ${data.ê²°ì œê¸ˆì•¡ || ''}`.trim();
}

/** (3) í…œí”Œë¦¿ ì½”ë“œì— ë§ì¶° ë©”ì‹œì§€ ì¹˜í™˜ */
function buildTemplateMessage(tplCode, parsingContent) {
  if (tplCode === TPLCODE_DEPOSIT) {
    return TEMPLATE_DEPOSIT.replace('#{íŒŒì‹±ë‚´ìš©}', parsingContent);
  } else if (tplCode === TPLCODE_STAY) {
    return TEMPLATE_STAY.replace('#{íŒŒì‹±ë‚´ìš©}', parsingContent);
  } else {
    return TEMPLATE_DAYUSE.replace('#{íŒŒì‹±ë‚´ìš©}', parsingContent);
  }
}
