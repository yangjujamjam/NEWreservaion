<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>예약업무 관리</title>
  <link rel="stylesheet" href="style.css">
  <script>
    const gasUrl = 'https://script.google.com/macros/s/AKfycbwCiRN7TNVJ6VWk97aD02jndsE5vTcx1pmGNpsTwGK495QsdYg5Lb3aio4RxHKMmuMR/exec'; // 배포 후 URL로 변경 필요

    document.addEventListener('DOMContentLoaded', function() {
      const inputData = document.getElementById('inputData');
      const outputData = document.getElementById('outputData');
      const buttons = document.querySelectorAll('.buttons button');
      const copyBtn = document.getElementById('copyBtn');

      buttons.forEach(button => {
        button.addEventListener('click', () => {
          if (button.id !== 'copyBtn') {
            const filteredText = filterText(inputData.value);
            const formattedText = formatText(filteredText, button.id);
            outputData.textContent = formattedText;
          }
        });
      });

      copyBtn.addEventListener('click', () => {
        const textToCopy = outputData.textContent;
        navigator.clipboard.writeText(textToCopy).then(() => alert('결과 복사됨'));
      });

      function filterText(text) {
        const lines = text.split('\n').filter(line => {
          const unwantedKeywords = ['예약번호', '예약유형', '이메일', '예약내역', '유입경로', '예약자입력정보', '결제정보', '결제상태', 'NPay주문번호', '결제수단'];
          return !unwantedKeywords.some(keyword => line.includes(keyword));
        });
        return lines.join('\n');
      }

      function formatText(text, buttonId) {
        switch (buttonId) {
          case 'btn1':
            return `고객님 예약 신청해 주셔서 진심으로 감사드립니다.\n\n${text}`;
          case 'btn2':
            return `[양주잼잼] 예약해 주셔서 진심으로 감사합니다♬\n\n${text}`;
          case 'btn3':
            return `[양주잼잼] 당일캠핑 예약 감사합니다.\n\n${text}`;
          case 'btn4':
            return `[양주잼잼] 늦은 입실 예약 감사합니다.\n\n${text}`;
          case 'btn5':
            return `[양주잼잼] 빠른 입실 예약 감사합니다.\n\n${text}`;
          case 'btn6':
            return `[양주잼잼] 야놀자 예약 감사합니다.\n\n${text}`;
          case 'btn7':
            return `[양주잼잼] 여기어때 예약 감사합니다.\n\n${text}`;
          default:
            return text;
        }
      }

      function sendToSheet() {
        const parsedData = parseReservation(inputData.value);
        fetch(gasUrl + '?' + new URLSearchParams(parsedData))
          .then(r => r.text()).then(msg => alert(msg));
      }

      function parseReservation(text) {
        const lines = text.split('\n');
        let reservationNumber = lines.find(line => line.includes('예약번호'));
        if(reservationNumber) reservationNumber = reservationNumber.replace('예약번호','').replace(/[:\s]+/g,'').trim();

        let reservationName = lines.find(line => line.includes('예약자'));
        if(reservationName) reservationName = reservationName.replace('예약자','').replace(/[:\s]+/g,'').trim();

        let phoneNumber = lines.find(line => line.includes('전화번호'));
        if(phoneNumber) phoneNumber = phoneNumber.replace('전화번호','').replace(/[:\s]+/g,'').trim();

        let usagePeriod = lines.find(line => line.includes('이용기간'));
        if(usagePeriod) usagePeriod = usagePeriod.replace('이용기간','').trim();

        let paymentAmount = lines.find(line => line.includes('결제금액'));
        if(paymentAmount) paymentAmount = paymentAmount.replace('결제금액','').replace(/[:\s]+/g,'').trim();

        const data = {
          예약번호: reservationNumber || '',
          예약자: reservationName || '',
          전화번호: phoneNumber || '',
          이용객실: ['대형 카라반','복층 우드캐빈','파티룸','몽골텐트'].find(room => text.includes(room)) || '',
          이용기간: usagePeriod || '',
          수량: lines.find(line => line.includes('수량'))?.replace('수량', '').trim() || '',
          옵션: '',
          총이용인원: lines.find(line => line.includes('총 이용 인원 정보'))?.replace('총 이용 인원 정보', '').trim() || '',
          입실시간: lines.find(line => line.includes('입실 시간 선택'))?.replace('입실 시간 선택', '').trim() || '',
          결제금액: paymentAmount || '',
          예약플랫폼: text.includes('야놀자') ? '야놀자' : text.includes('여기어때') ? '여기어때' : '네이버'
        };

        return data;
      }

      window.sendToSheet = sendToSheet;
    });
  </script>
</head>
<body>
  <header class="top-menu">
    <nav>
      <ul>
        <li><a href="예약업무.html">예약업무</a></li>
        <li><a href="예약관리.html">예약관리</a></li>
        <li><a href="예약캘린더.html">예약캘린더</a></li>
      </ul>
    </nav>
  </header>

  <h1>예약업무 관리</h1>

  <textarea id="inputData" placeholder="예약 텍스트를 입력하세요"></textarea>

  <div class="buttons">
    <button id="btn1">예약안내문자(무통장)</button>
    <button id="btn2">예약확정문자(숙박)</button>
    <button id="btn3">예약확정문자(당일캠핑)</button>
    <button id="btn4">예약확정문자(늦은 입실)</button>
    <button id="btn5">예약확정문자(빠른 입실)</button>
    <button id="btn6">예약확정문자(야놀자)</button>
    <button id="btn7">예약확정문자(여기어때)</button>
  </div>

  <div class="button-container">
    <button id="copyBtn">결과 복사</button>
    <button onclick="sendToSheet()">구글 스프레드시트로 보내기</button>
  </div>

  <pre id="outputData">결과가 여기에 출력됩니다.</pre>

</body>
</html>
